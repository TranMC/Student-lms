<div class="welcome-section">
    <h2>Hồ sơ học sinh</h2>
    <p class="date-time" id="currentDateTime"></p>
</div>

<div class="profile-container">
    <div class="profile-card">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">
                <img id="avatarImage" src="" alt="Avatar" onerror="this.style.display='none'; document.querySelector('#profileAvatar i').style.display='block';">
                <i class="fas fa-user-graduate"></i>
            </div>
            <button id="changeAvatarBtn" class="btn btn-sm btn-outline-primary mt-2">
                <i class="fas fa-camera"></i> Đổi ảnh đại diện
            </button>
            <h2 id="studentFullName"></h2>
            <p id="studentId"></p>
            <div class="profile-status">
                <span class="status-badge active">
                    <i class="fas fa-check-circle"></i> Đang học
                </span>
            </div>
        </div>
        
        <div class="profile-info">
            <div class="info-section">
                <h3><i class="fas fa-info-circle"></i> Thông tin cơ bản</h3>
                <div class="info-grid">
                    <div class="info-group">
                        <label>Họ và tên:</label>
                        <span id="studentFullNameInfo"></span>
                    </div>
                    <div class="info-group">
                        <label>Ngày sinh:</label>
                        <span id="studentBirthday"></span>
                    </div>
                    <div class="info-group">
                        <label>Giới tính:</label>
                        <span id="studentGender"></span>
                    </div>
                    <div class="info-group">
                        <label>Lớp:</label>
                        <span id="studentClass"></span>
                    </div>
                    <div class="info-group">
                        <label>Niên khóa:</label>
                        <span id="studentYear"></span>
                    </div>
                    <div class="info-group">
                        <label>Khối:</label>
                        <span id="studentGrade"></span>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-address-card"></i> Thông tin liên hệ</h3>
                <div class="info-grid">
                    <div class="info-group">
                        <label>Email:</label>
                        <span id="studentEmail"></span>
                    </div>
                    <div class="info-group">
                        <label>Số điện thoại:</label>
                        <span id="studentPhone"></span>
                    </div>
                    <div class="info-group">
                        <label>Địa chỉ:</label>
                        <span id="studentAddress"></span>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-users"></i> Thông tin gia đình</h3>
                <div class="info-grid">
                    <div class="info-group">
                        <label>Họ tên phụ huynh:</label>
                        <span id="parentName"></span>
                    </div>
                    <div class="info-group">
                        <label>Số điện thoại phụ huynh:</label>
                        <span id="parentPhone"></span>
                    </div>
                    <div class="info-group">
                        <label>Email phụ huynh:</label>
                        <span id="parentEmail"></span>
                    </div>
                </div>
            </div>

            <div class="info-section">
                <h3><i class="fas fa-graduation-cap"></i> Thông tin học tập</h3>
                <div class="academic-info">
                    <div class="semester-grades">
                        <h3>Điểm số học kỳ</h3>
                        <div class="grades-grid">
                            <div class="grade-card">
                                <h4>Học kỳ 1</h4>
                                <div class="grade-value" id="gpa1">0.0</div>
                            </div>
                            <div class="grade-card">
                                <h4>Học kỳ 2</h4>
                                <div class="grade-value" id="gpa2">0.0</div>
                            </div>
                            <div class="grade-card">
                                <h4>Cả năm</h4>
                                <div class="grade-value" id="gpaYear">0.0</div>
                            </div>
                        </div>
                    </div>

                    <div class="rankings">
                        <div class="ranking-card">
                            <h4>Xếp loại học lực</h4>
                            <div class="ranking-value" id="academicRank">-</div>
                        </div>
                        <div class="ranking-card">
                            <h4>Hạnh kiểm</h4>
                            <div class="ranking-value" id="conductRank">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="profile-actions">
            <button class="btn btn-primary" id="editProfileBtn">
                <i class="fas fa-edit"></i> Cập nhật thông tin
            </button>
            <button class="btn btn-secondary" id="changePasswordBtn">
                <i class="fas fa-key"></i> Đổi mật khẩu
            </button>
            <button class="btn btn-info" id="printProfileBtn">
                <i class="fas fa-print"></i> In hồ sơ
            </button>
        </div>
    </div>
</div>

<!-- Modal Edit Profile -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cập nhật thông tin</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <!-- Thông tin cá nhân -->
                    <h4 class="section-title">Thông tin cá nhân</h4>
                    <div class="mb-3">
                        <label for="editFullName" class="form-label">Họ và tên</label>
                        <input type="text" class="form-control" id="editFullName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editBirthday" class="form-label">Ngày sinh</label>
                        <input type="date" class="form-control" id="editBirthday">
                    </div>
                    <div class="mb-3">
                        <label for="editGender" class="form-label">Giới tính</label>
                        <select class="form-control" id="editGender">
                            <option value="Nam">Nam</option>
                            <option value="Nữ">Nữ</option>
                        </select>
                    </div>
                    <!-- Thông tin liên hệ -->
                    <div class="mb-3">
                        <label for="editEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editEmail">
                    </div>
                    <div class="mb-3">
                        <label for="editPhone" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="editPhone">
                    </div>
                    <div class="mb-3">
                        <label for="editAddress" class="form-label">Địa chỉ</label>
                        <input type="text" class="form-control" id="editAddress">
                    </div>

                    <!-- Phụ huynh 1 -->
                    <h4 class="section-title">Phụ huynh 1</h4>
                    <div class="mb-3">
                        <label for="editParent1Name" class="form-label">Họ tên phụ huynh 1</label>
                        <input type="text" class="form-control" id="editParent1Name">
                    </div>
                    <div class="mb-3">
                        <label for="editParent1Relation" class="form-label">Mối quan hệ</label>
                        <select class="form-control" id="editParent1Relation">
                            <option value="">Chọn mối quan hệ</option>
                            <option value="Cha">Cha</option>
                            <option value="Mẹ">Mẹ</option>
                            <option value="Ông">Ông</option>
                            <option value="Bà">Bà</option>
                            <option value="Khác">Khác</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editParent1Phone" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="editParent1Phone">
                    </div>
                    <div class="mb-3">
                        <label for="editParent1Email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editParent1Email">
                    </div>

                    <!-- Phụ huynh 2 -->
                    <h4 class="section-title">Phụ huynh 2</h4>
                    <div class="mb-3">
                        <label for="editParent2Name" class="form-label">Họ tên phụ huynh 2</label>
                        <input type="text" class="form-control" id="editParent2Name">
                    </div>
                    <div class="mb-3">
                        <label for="editParent2Relation" class="form-label">Mối quan hệ</label>
                        <select class="form-control" id="editParent2Relation">
                            <option value="">Chọn mối quan hệ</option>
                            <option value="Cha">Cha</option>
                            <option value="Mẹ">Mẹ</option>
                            <option value="Ông">Ông</option>
                            <option value="Bà">Bà</option>
                            <option value="Khác">Khác</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editParent2Phone" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="editParent2Phone">
                    </div>
                    <div class="mb-3">
                        <label for="editParent2Email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="editParent2Email">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveProfileBtn">Lưu thay đổi</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Change Password -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Đổi mật khẩu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="currentPassword" class="form-label">Mật khẩu hiện tại</label>
                    <input type="password" class="form-control" id="currentPassword">
                </div>
                <div class="mb-3">
                    <label for="newPassword" class="form-label">Mật khẩu mới</label>
                    <input type="password" class="form-control" id="newPassword">
                </div>
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
                    <input type="password" class="form-control" id="confirmPassword">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="savePasswordBtn">Lưu thay đổi</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal đổi ảnh đại diện -->
<div class="modal fade" id="changeAvatarModal" tabindex="-1" aria-labelledby="changeAvatarModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changeAvatarModalLabel">Đổi ảnh đại diện</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="avatarInput" class="form-label">Chọn ảnh mới</label>
                    <input type="file" class="form-control" id="avatarInput" accept="image/*">
                </div>
                <div class="text-center">
                    <img id="avatarPreview" src="" alt="Avatar Preview" style="max-width: 200px; display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="studentProfile.saveAvatar()">Lưu thay đổi</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>

<!-- Template in hồ sơ -->
<div id="printTemplate" style="display: none;">
    <div class="print-profile">
        <div class="school-info">
            <h2>TRƯỜNG THPT ABC</h2>
            <h3>HỒ SƠ HỌC SINH</h3>
        </div>
        <div class="student-info">
            <!-- Nội dung sẽ được điền động bởi JavaScript -->
        </div>
        <div class="academic-info">
            <!-- Nội dung sẽ được điền động bởi JavaScript -->
        </div>
    </div>
</div>

<style>
    @media print {
        body * {
            visibility: hidden !important;
        }
        #printTemplate, #printTemplate * {
            visibility: visible !important;
        }
        #printTemplate {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }
    }
    
    .print-profile {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .school-info {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .student-info {
        margin-bottom: 30px;
    }
    
    .student-info h2 {
        margin-bottom: 15px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
    }
    
    .academic-info h3 {
        margin-bottom: 15px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
    }
</style>

<script src="js/student-profile.js"></script>
<script>
    console.log('Script trong student-profile-content.html đang chạy');
    
    // Gắn trực tiếp sự kiện cho các nút
    document.getElementById('editProfileBtn').onclick = function() {
        console.log('Đã nhấp nút editProfileBtn');
        if (window.studentProfile) {
            window.studentProfile.editProfile();
        } else {
            console.error('studentProfile chưa được khởi tạo');
            // Thử khởi tạo ngay
            window.studentProfile = new StudentProfile();
            window.studentProfile.editProfile();
        }
    };
    
    document.getElementById('changePasswordBtn').onclick = function() {
        console.log('Đã nhấp nút changePasswordBtn');
        if (window.studentProfile) {
            window.studentProfile.changePassword();
        } else {
            console.error('studentProfile chưa được khởi tạo');
            window.studentProfile = new StudentProfile();
            window.studentProfile.changePassword();
        }
    };
    
    document.getElementById('printProfileBtn').onclick = function() {
        console.log('Đã nhấp nút printProfileBtn');
        if (window.studentProfile) {
            window.studentProfile.printProfile();
        } else {
            console.error('studentProfile chưa được khởi tạo');
            window.studentProfile = new StudentProfile();
            window.studentProfile.printProfile();
        }
    };
    
    document.getElementById('changeAvatarBtn').onclick = function() {
        console.log('Đã nhấp nút changeAvatarBtn');
        if (window.studentProfile) {
            window.studentProfile.changeAvatar();
        } else {
            console.error('studentProfile chưa được khởi tạo');
            window.studentProfile = new StudentProfile();
            window.studentProfile.changeAvatar();
        }
    };
    
    // Thêm sự kiện cho modal buttons
    document.getElementById('saveProfileBtn').onclick = function() {
        console.log('Đã nhấp nút saveProfileBtn');
        if (window.studentProfile) {
            window.studentProfile.saveProfile();
        }
    };
    
    document.getElementById('savePasswordBtn').onclick = function() {
        console.log('Đã nhấp nút savePasswordBtn');
        if (window.studentProfile) {
            window.studentProfile.savePassword();
        }
    };
    
    document.getElementById('saveAvatarBtn').onclick = function() {
        console.log('Đã nhấp nút saveAvatarBtn');
        if (window.studentProfile) {
            window.studentProfile.saveAvatar();
        }
    };
    
    // Thêm sự kiện cho upload ảnh
    const avatarUpload = document.getElementById('avatarUpload');
    if (avatarUpload) {
        avatarUpload.onchange = function(e) {
            console.log('Đã chọn file ảnh đại diện');
            if (window.studentProfile) {
                window.studentProfile.previewAvatar(e);
            }
        };
    }
    
    // Đảm bảo dữ liệu được tải
    if (window.studentProfile) {
        console.log('Tải lại dữ liệu hồ sơ');
        window.studentProfile.loadProfileData();
        window.studentProfile.loadAvatar();
    } else {
        console.log('Khởi tạo StudentProfile từ script trong content');
        window.studentProfile = new StudentProfile();
    }
</script> 